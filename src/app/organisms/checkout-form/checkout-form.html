<div class="card border-0 shadow-lg rounded-4 p-4 bg-white">
  <div class="d-flex align-items-center mb-4 border-bottom pb-3">
    <i class="bi bi-credit-card-2-front text-primary fs-3 me-3"></i>
    <h4 class="fw-bold text-dark mb-0">Finalizar Pedido</h4>
  </div>
  
  <form [formGroup]="form" (ngSubmit)="pagar()">
    
    <div class="row g-3 mb-4">
      <div class="col-md-4">
        <div class="form-floating">
          <input type="text" class="form-control bg-light border-0" id="hora" formControlName="hora" placeholder="20:30"
                 [class.is-invalid]="form.get('hora')?.touched && form.get('hora')?.invalid">
          <label for="hora">Hora (HH:MM)</label>
          @if (form.get('hora')?.invalid && form.get('hora')?.touched) {
            <div class="invalid-feedback">Formato incorrecto</div>
          }
        </div>
      </div>
      <div class="col-md-8">
        <div class="form-floating">
          <input type="text" class="form-control bg-light border-0" id="dir" formControlName="direccion" placeholder="Dir"
                 [class.is-invalid]="form.get('direccion')?.touched && form.get('direccion')?.invalid">
          <label for="dir">Dirección completa</label>
          @if (form.get('direccion')?.hasError('required') && form.get('direccion')?.touched) {
            <div class="invalid-feedback">Dirección obligatoria</div>
          }
        </div>
      </div>
    </div>

    <h6 class="fw-bold text-primary mb-3 small text-uppercase ls-1">Selecciona Método</h6>

    <div class="row g-3 mb-4"> <div class="col-md-6">
        <div class="p-3 rounded-3 border h-100 transition-all" 
             [class.border-primary]="isTarjeta" 
             [class.bg-primary-subtle]="isTarjeta"
             [class.opacity-75]="!isTarjeta">
          
          <div class="form-check mb-3">
            <input class="form-check-input" type="radio" name="metodo" id="rt" value="tarjeta" formControlName="metodo">
            <label class="form-check-label fw-bold d-flex align-items-center gap-2 w-100 cursor-pointer" for="rt">
              <i class="bi bi-credit-card"></i> Tarjeta
            </label>
          </div>

          <div class="ms-4">
            <input type="text" class="form-control form-control-sm" formControlName="tarjeta" placeholder="16 dígitos" maxlength="16"
                   [class.is-invalid]="form.get('tarjeta')?.touched && form.get('tarjeta')?.invalid">
            @if (form.get('tarjeta')?.touched && form.get('tarjeta')?.invalid) {
              <div class="invalid-feedback small">Requerido: 16 dígitos.</div>
            }
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="p-3 rounded-3 border h-100 transition-all"
             [class.border-primary]="isBizum" 
             [class.bg-primary-subtle]="isBizum"
             [class.opacity-75]="!isBizum">
          
          <div class="form-check mb-3">
            <input class="form-check-input" type="radio" name="metodo" id="rb" value="bizum" formControlName="metodo">
            <label class="form-check-label fw-bold d-flex align-items-center gap-2 w-100 cursor-pointer" for="rb">
              <i class="bi bi-phone"></i> Bizum
            </label>
          </div>

          <div class="ms-4">
            <input type="text" class="form-control form-control-sm" formControlName="telefono" placeholder="9 dígitos" maxlength="9"
                   [class.is-invalid]="form.get('telefono')?.touched && form.get('telefono')?.invalid">
            @if (form.get('telefono')?.touched && form.get('telefono')?.invalid) {
              <div class="invalid-feedback small">Requerido: 9 dígitos.</div>
            }
          </div>
        </div>
      </div>
    </div>

    @if (service.totalPrice() === 0) {
      <div class="alert alert-warning d-flex align-items-center p-3 rounded-3 mb-4 border-warning-subtle shadow-sm" role="alert">
        <i class="bi bi-cart-x-fill fs-4 me-3 text-warning-emphasis"></i>
        <div>
          <strong class="d-block text-warning-emphasis">Tu carrito está vacío</strong>
          <small class="text-muted">Añade al menos una pizza para poder realizar el pedido.</small>
        </div>
      </div>
    }

    <div class="d-grid gap-2 d-md-flex">
      <button type="submit" class="btn btn-primary btn-lg rounded-pill fw-bold shadow-sm flex-grow-1"
              [disabled]="form.invalid || service.totalPrice() === 0">
        PAGAR {{ service.totalPrice() | currency:'EUR' }}
      </button>
      
      <button type="button" class="btn btn-outline-secondary rounded-pill px-4" (click)="limpiar()">
        Limpiar
      </button>
    </div>

  </form>
</div>

@if (showModal) {
  <div class="position-fixed top-0 start-0 w-100 h-100 bg-dark bg-opacity-75 d-flex align-items-center justify-content-center" style="z-index: 2000;">
    <div class="card p-5 text-center rounded-5 shadow-lg animate-pop bg-white border-0" style="max-width: 400px;">
      <div class="mb-3 text-success display-1"><i class="bi bi-check-circle-fill"></i></div>
      <h2 class="fw-bold text-dark mb-3">¡Pedido Recibido!</h2>
      <p class="text-muted mb-4">
        Tu pizza llegará a las <strong>{{ form.get('hora')?.value }}</strong> a<br>
        <em>{{ form.get('direccion')?.value }}</em>
      </p>
      <button class="btn btn-success w-100 rounded-pill py-3 fw-bold shadow-sm" (click)="confirmarPedido()">ENTENDIDO</button>
    </div>
  </div>
}